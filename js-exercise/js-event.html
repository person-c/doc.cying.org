<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .title {
        font-size: 20px;
        font-weight: 100;
      }

      .tree span:hover {
        font-weight: bold;
      }

      .tree span {
        cursor: pointer;
      }

      body {
        height: 2000px;
        /* make body scrollable, the tooltip should work after the scroll */
      }

      .tooltip {
        position: fixed;
        padding: 10px 20px;
        border: 1px solid #b3c9ce;
        border-radius: 4px;
        text-align: center;
        font: italic 14px/1.3 sans-serif;
        color: #333;
        background: #fff;
        box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.3);
      }

      #contents {
        padding: 5px;
        border: 1px green solid;
      }

      body {
        margin: 0;
        padding: 0;
        font: 75%/120% sans-serif;
      }

      #largeImg {
        border: solid 1px #ccc;
        width: 550px;
        height: 400px;
        padding: 5px;
      }

      #thumbs a {
        border: solid 1px #ccc;
        width: 100px;
        height: 100px;
        padding: 3px;
        margin: 2px;
        float: left;
      }

      #thumbs a:hover {
        border-color: #ff9900;
      }

      #thumbs li {
        list-style: none;
      }

      #thumbs {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <p class="title">Hide message</p>
    <hr />
    <div id="message-box">
      <div class="pane">
        <h3>Horse</h3>
        <p>
          The horse is one of two extant subspecies of Equus ferus. It is an
          odd-toed ungulate mammal belonging to the taxonomic family Equidae.
          The horse has evolved over the past 45 to 55 million years from a
          small multi-toed creature, Eohippus, into the large, single-toed
          animal of today.
        </p>
        <button class="remove-button">[x]</button>
      </div>
      <div class="pane">
        <h3>Donkey</h3>
        <p>
          The donkey or ass (Equus africanus asinus) is a domesticated member of
          the horse family, Equidae. The wild ancestor of the donkey is the
          African wild ass, E. africanus. The donkey has been used as a working
          animal for at least 5000 years.
        </p>
        <button class="remove-button">[x]</button>
      </div>
      <div class="pane">
        <h3>Cat</h3>
        <p>
          The domestic cat (Latin: Felis catus) is a small, typically furry,
          carnivorous mammal. They are often called house cats when kept as
          indoor pets or simply cats when there is no need to distinguish them
          from other felids and felines. Cats are often valued by humans for
          companionship and for their ability to hunt vermin.
        </p>
        <button class="remove-button">[x]</button>
      </div>
    </div>

    <p class="title">Toggle tree menu</p>
    <hr />
    <ul class="tree" id="tree">
      <li>
        Animals
        <ul>
          <li>
            Mammals
            <ul>
              <li>Cows</li>
              <li>Donkeys</li>
              <li>Dogs</li>
              <li>Tigers</li>
            </ul>
          </li>
          <li>
            Other
            <ul>
              <li>Snakes</li>
              <li>Birds</li>
              <li>Lizards</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        Fishes
        <ul>
          <li>
            Aquarium
            <ul>
              <li>Guppy</li>
              <li>Angelfish</li>
            </ul>
          </li>
          <li>
            Sea
            <ul>
              <li>Sea trout</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>

    <p class="title">Sorted table</p>
    <hr />
    <table id="grid">
      <thead>
        <tr>
          <th data-type="number">Age</th>
          <th data-type="string">Name</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>5</td>
          <td>John</td>
        </tr>
        <tr>
          <td>2</td>
          <td>Pete</td>
        </tr>
        <tr>
          <td>12</td>
          <td>Ann</td>
        </tr>
        <tr>
          <td>9</td>
          <td>Eugene</td>
        </tr>
        <tr>
          <td>1</td>
          <td>Ilya</td>
        </tr>
      </tbody>
    </table>

    <p class="title">Tooltip</p>
    <hr />
    <p>LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa</p>
    <p>LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa LaLaLa</p>

    <button data-tooltip="the tooltip is longer than the element">
      Short button
    </button>
    <button data-tooltip="HTML<br>tooltip">One more button</button>

    <p>
      Scroll the page to make buttons appear on the top, check if the tooltips
      show up correctly.
    </p>

    <p class="title">Really leave</p>
    <hr />
    <fieldset id="contents">
      <legend>#contents</legend>
      <p>
        How about to read <a href="https://wikipedia.org">Wikipedia</a> or visit
        <a href="https://w3.org"><i>W3.org</i></a> and learn about modern
        standards?
      </p>
    </fieldset>

    <p class="title">Shift picture</p>
    <hr />
    <p>
      <img
        id="largeImg"
        src="https://en.js.cx/gallery/img1-lg.jpg"
        alt="Large image"
      />
    </p>

    <ul id="thumbs">
      <!-- the browser shows a small built-in tooltip on hover with the text from "title" attribute -->
      <li>
        <a href="https://en.js.cx/gallery/img2-lg.jpg" title="Image 2"
          ><img
            src="https://en.js.cx/gallery/img2-thumb.jpg"
            title="Image 2"
            alt="Image 2"
        /></a>
      </li>
      <li>
        <a href="https://en.js.cx/gallery/img3-lg.jpg" title="Image 3"
          ><img src="https://en.js.cx/gallery/img3-thumb.jpg" title="image 3"
        /></a>
      </li>
      <li>
        <a href="https://en.js.cx/gallery/img4-lg.jpg" title="Image 4"
          ><img src="https://en.js.cx/gallery/img4-thumb.jpg" title="Image 4"
        /></a>
      </li>
      <li>
        <a href="https://en.js.cx/gallery/img5-lg.jpg" title="Image 5"
          ><img src="https://en.js.cx/gallery/img5-thumb.jpg" title="Image 5"
        /></a>
      </li>
      <li>
        <a href="https://en.js.cx/gallery/img6-lg.jpg" title="Image 6"
          ><img src="https://en.js.cx/gallery/img6-thumb.jpg" title="Image 6"
        /></a>
      </li>
    </ul>
    <script>
      // Hide messages
      let messageBox = document.querySelector('#message-box');
      messageBox.addEventListener('click', function (e) {
        if (e.target.className != 'remove-button') return;

        let pane = e.target.closest('.pane');
        console.log(pane.innerHTML);
        pane.remove();
      });

      // toggle tree menu
      // move all text into span
      let tree = document.querySelector('#tree');
      for (let li of tree.querySelectorAll('li')) {
        let span = document.createElement('span');
        li.prepend(span);
        span.append(span.nextSibling);
      }
      //
      tree.addEventListener('click', function (e) {
        if (e.target.tagName != 'SPAN') return;

        let childrenContainer = e.target.parentNode.querySelector('ul');
        if (!childrenContainer) return; // no children
        childrenContainer.hidden = !childrenContainer.hidden;
      });

      // sorted table
      let grid = document.querySelector('#grid');
      grid.addEventListener('click', function (e) {
        if (e.target.tagName != 'TH') return;

        let th = e.target;
        console.log(th);
        sortTable(th.cellIndex, th.dataset.type);
      });

      function sortTable(colIndex, type) {
        let tbody = grid.querySelector('tbody');

        let arrayRows = Array.from(tbody.rows);

        let compare;

        switch (type) {
          case 'number':
            compare = function (a, b) {
              return a.cells[colIndex].innerHTML - b.cells[colIndex].innerHTML;
            };
            break;
          case 'string':
            compare = function (a, b) {
              return a.cells[colIndex].innerHTML > b.cells[colIndex].innerHTML
                ? 1
                : -1;
            };
            break;
        }

        arrayRows.sort(compare);
        tbody.append(...arrayRows);
      }

      // tooltip
      let tip;
      document.addEventListener('mouseover', function (e) {
        let target = e.target;

        let tipHTML = target.dataset.tooltip;
        if (!tipHTML) return;
        //create tooltip div element
        let tip = document.createElement('div');
        tip.innerHTML = tipHTML;
        tip.className = 'tooltip';
        document.body.append(tip);

        //tooltip position
        // position it above the annotated element (top-center)
        let coords = target.getBoundingClientRect();

        let left = coords.left + (target.offsetWidth - tip.offsetWidth) / 2;
        if (left < 0) left = 0; // don't cross the left window edge

        let top = coords.top - tip.offsetHeight - 5;
        if (top < 0) {
          // if crossing the top window edge, show below instead
          top = coords.top + target.offsetHeight + 5;
        }

        tip.style.left = left + 'px';
        tip.style.top = top + 'px';
        // mouseover
        document.addEventListener('mouseover', function (e) {
          if (tip) {
            tip.remove();
            tip = null;
          }
        });
      });

      // capture link
      // add event listeners is not useful here, why?
      function handleLink(href) {
        let isLeaving = confirm(`Leave for ${href}?`);
        if (!isLeaving) return false;
      }
      contents.onclick = function (event) {
        let target = event.target.closest('a');

        if (target && contents.contains(target)) {
          return handleLink(target.getAttribute('href'));
        }
      };

      // shift pictures
      thumbs.addEventListener('click', (e) => {
        let thumbnail = e.target.closest('a');

        if (!thumbnail) return;
        largeImg.src = thumbnail.href;
        largeImg.alt = thumbnail.title;
        e.preventDefault();
      });
    </script>
  </body>
</html>
