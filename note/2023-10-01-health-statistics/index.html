<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-10-01">

<title>Health Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../static/css/font.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#统计描述" id="toc-统计描述" class="nav-link active" data-scroll-target="#统计描述">统计描述</a>
  <ul class="collapse">
  <li><a href="#数值变量" id="toc-数值变量" class="nav-link" data-scroll-target="#数值变量">数值变量</a></li>
  <li><a href="#分类变量" id="toc-分类变量" class="nav-link" data-scroll-target="#分类变量">分类变量</a></li>
  </ul></li>
  <li><a href="#实验设计与调查研究" id="toc-实验设计与调查研究" class="nav-link" data-scroll-target="#实验设计与调查研究">实验设计与调查研究</a>
  <ul class="collapse">
  <li><a href="#实验设计" id="toc-实验设计" class="nav-link" data-scroll-target="#实验设计">实验设计</a></li>
  <li><a href="#调查研究" id="toc-调查研究" class="nav-link" data-scroll-target="#调查研究">调查研究</a></li>
  </ul></li>
  <li><a href="#parametric-statistics" id="toc-parametric-statistics" class="nav-link" data-scroll-target="#parametric-statistics">Parametric Statistics</a>
  <ul class="collapse">
  <li><a href="#sampling-distribution-for-chi2-f-t" id="toc-sampling-distribution-for-chi2-f-t" class="nav-link" data-scroll-target="#sampling-distribution-for-chi2-f-t">Sampling Distribution for <span class="math inline">\(\chi^2, F, t\)</span></a></li>
  <li><a href="#tz-text-test" id="toc-tz-text-test" class="nav-link" data-scroll-target="#tz-text-test"><span class="math inline">\(t/z \text{ Test }\)</span></a>
  <ul class="collapse">
  <li><a href="#assumptions-and-its-application-case" id="toc-assumptions-and-its-application-case" class="nav-link" data-scroll-target="#assumptions-and-its-application-case">Assumptions and Its Application Case</a></li>
  <li><a href="#one-smple-t-test" id="toc-one-smple-t-test" class="nav-link" data-scroll-target="#one-smple-t-test">One Smple <span class="math inline">\(t\)</span>-Test</a></li>
  <li><a href="#paired-t-test" id="toc-paired-t-test" class="nav-link" data-scroll-target="#paired-t-test">Paired <span class="math inline">\(t\)</span>-Test</a></li>
  <li><a href="#independent-two-sample-t-test" id="toc-independent-two-sample-t-test" class="nav-link" data-scroll-target="#independent-two-sample-t-test">Independent Two Sample <span class="math inline">\(t\)</span>-Test</a></li>
  </ul></li>
  <li><a href="#bn-ppolambda-text-test" id="toc-bn-ppolambda-text-test" class="nav-link" data-scroll-target="#bn-ppolambda-text-test"><span class="math inline">\(B(n, p)/Po(\lambda) \text{ Test}\)</span></a></li>
  <li><a href="#aanlysis-of-variance" id="toc-aanlysis-of-variance" class="nav-link" data-scroll-target="#aanlysis-of-variance">Aanlysis of Variance</a>
  <ul class="collapse">
  <li><a href="#one-way-annova" id="toc-one-way-annova" class="nav-link" data-scroll-target="#one-way-annova">One Way ANNOVA</a></li>
  <li><a href="#special-two-way-annova---random-block-design" id="toc-special-two-way-annova---random-block-design" class="nav-link" data-scroll-target="#special-two-way-annova---random-block-design">Special Two Way ANNOVA - Random Block Design</a></li>
  </ul></li>
  <li><a href="#mutiple-hypothesis-test" id="toc-mutiple-hypothesis-test" class="nav-link" data-scroll-target="#mutiple-hypothesis-test">Mutiple Hypothesis Test</a>
  <ul class="collapse">
  <li><a href="#q--teststudent-newman-keuls" id="toc-q--teststudent-newman-keuls" class="nav-link" data-scroll-target="#q--teststudent-newman-keuls"><span class="math inline">\(q\)</span> -Test/student Newman-Keuls</a></li>
  <li><a href="#dunnett-t-test" id="toc-dunnett-t-test" class="nav-link" data-scroll-target="#dunnett-t-test"><span class="math inline">\(Dunnett-t\)</span> Test</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#non-parametric-statistics" id="toc-non-parametric-statistics" class="nav-link" data-scroll-target="#non-parametric-statistics">Non-parametric Statistics</a>
  <ul class="collapse">
  <li><a href="#chi2-text-test" id="toc-chi2-text-test" class="nav-link" data-scroll-target="#chi2-text-test"><span class="math inline">\(\chi^2 \text{ Test}\)</span></a></li>
  <li><a href="#rank-based-test" id="toc-rank-based-test" class="nav-link" data-scroll-target="#rank-based-test">Rank Based Test</a>
  <ul class="collapse">
  <li><a href="#wilcoxon-signed-rank-test-for-paired-sample" id="toc-wilcoxon-signed-rank-test-for-paired-sample" class="nav-link" data-scroll-target="#wilcoxon-signed-rank-test-for-paired-sample">Wilcoxon Signed Rank Test for Paired Sample</a></li>
  <li><a href="#wilcoxon-rank-sum-testmann-whitney-test-for-independent-two-samples" id="toc-wilcoxon-rank-sum-testmann-whitney-test-for-independent-two-samples" class="nav-link" data-scroll-target="#wilcoxon-rank-sum-testmann-whitney-test-for-independent-two-samples">Wilcoxon Rank Sum Test/Mann Whitney Test for Independent Two Samples</a></li>
  <li><a href="#annova-for-rank" id="toc-annova-for-rank" class="nav-link" data-scroll-target="#annova-for-rank">ANNOVA for Rank</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#correlation-ann-linear-regression" id="toc-correlation-ann-linear-regression" class="nav-link" data-scroll-target="#correlation-ann-linear-regression">Correlation ann Linear Regression</a>
  <ul class="collapse">
  <li><a href="#pearsonspearman-correlation" id="toc-pearsonspearman-correlation" class="nav-link" data-scroll-target="#pearsonspearman-correlation">Pearson/Spearman Correlation</a></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression">Simple Linear Regression</a></li>
  </ul></li>
  <li><a href="#关于假设检验中若干问题" id="toc-关于假设检验中若干问题" class="nav-link" data-scroll-target="#关于假设检验中若干问题">关于假设检验中若干问题</a>
  <ul class="collapse">
  <li><a href="#假设检验原理" id="toc-假设检验原理" class="nav-link" data-scroll-target="#假设检验原理">假设检验原理</a></li>
  <li><a href="#假设检验与置信区间" id="toc-假设检验与置信区间" class="nav-link" data-scroll-target="#假设检验与置信区间">假设检验与置信区间</a></li>
  <li><a href="#检验功效" id="toc-检验功效" class="nav-link" data-scroll-target="#检验功效">检验功效</a></li>
  <li><a href="#统计量计算的bootstrap以及置换检验" id="toc-统计量计算的bootstrap以及置换检验" class="nav-link" data-scroll-target="#统计量计算的bootstrap以及置换检验">统计量计算的Bootstrap以及置换检验</a></li>
  <li><a href="#假设检验与线性回归参数检验的等效性" id="toc-假设检验与线性回归参数检验的等效性" class="nav-link" data-scroll-target="#假设检验与线性回归参数检验的等效性">假设检验与线性回归参数检验的等效性</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<script>
  // load font(from yihui.org)
  (function (d) {
    // https://www.kirupa.com/html5/detect_whether_font_is_installed.htm
    let canvas = document.createElement('canvas');
    let context = canvas.getContext('2d');
    let text = 'abcdefghijklmnopqrstuvwxyz0123456789';
    context.font = '72px monospace';
    let size = context.measureText(text).width;
    let fonts = [' SC', ' CN', ' TC', ' TW', ''];
    for (let i = 0; i < fonts.length; i++) {
      context.font = "72px '" + 'Source Han Serif' + fonts[i] + "', monospace";
      // no need to load TypeKit if Source Hans Serif has been installed
      if (context.measureText(text).width != size) return;
    }
    let config = { kitId: 'kwz5xar', scriptTimeout: 3000, async: true },
      h = d.documentElement,
      t = setTimeout(function () {
        h.className =
          h.className.replace(/\bwf-loading\b/g, '') + ' wf-inactive';
      }, config.scriptTimeout),
      tk = d.createElement('script'),
      f = false,
      s = d.getElementsByTagName('script')[0],
      a;
    h.className += ' wf-loading';
    tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
    tk.async = true;
    tk.onload = tk.onreadystatechange = function () {
      a = this.readyState;
      if (f || (a && a != 'complete' && a != 'loaded')) return;
      f = true;
      clearTimeout(t);
      try {
        Typekit.load(config);
      } catch (e) {}
    };
    s.parentNode.insertBefore(tk, s);
  })(document);
</script>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Health Statistics</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<hr>
<section id="统计描述" class="level1">
<h1>统计描述</h1>
<p>首先了解数据的频数分布，选用合适的集中以及离散趋势描述数据。</p>
<ul>
<li>观察单位。被观察或测量对象的最基本单位。</li>
<li>变量类型。数值变量/分类变量——有序，无序。</li>
<li>同质（homogeneity）与变异（variation）。研究对象具有的相同的状况或属性等共性称同质。对于同质的各观察单位，其某变量之间的差异，称为变异。</li>
<li>总体（population）。总体是根据研究目的确定的同质的观察单位全体，确切地说，是同质的所有观察单位某种变量值的集合。</li>
<li>样本（sample）。样本是指总体中的一部分观察单位的某项变量值的集合，这一部分必须是对总体具有代表性的。</li>
<li>误差（error）。包括系统误差（systermatic error） 以及 随机测量误差（error of randon measurement）和 抽样误差（sampling error）。</li>
</ul>
<section id="数值变量" class="level2">
<h2 class="anchored" data-anchor-id="数值变量">数值变量</h2>
<p>频数表的编制：</p>
<ol type="1">
<li>求全距。</li>
<li>确定组数, <span class="math inline">\(range / n\)</span> 取整 <span class="math inline">\([x, x + n)\)</span>。</li>
<li>列表划计。</li>
</ol>
<ul>
<li>对称或者正态分布数据选用算术均值描述其均值，方差/标准差/变异系数描述其离散程度。</li>
</ul>
<blockquote class="blockquote">
<p>标准差，变异系数是同单位的。变异系数用于不同尺度，均值相差较大的数据直接相互比较。 方差/标准差/变异系数的计算都依赖于均值的计算。</p>
<ol type="1">
<li><span class="math inline">\(CV = \frac{S}{\bar{X}} \cdot 100\%\)</span></li>
</ol>
</blockquote>
<ul>
<li>对数正态分布数据, 例如抗体的几何滴度，细菌计数等，选用几何均值描述其分布，全距/四分位数描述其离散趋势。</li>
</ul>
<ol type="1">
<li><span class="math inline">\(G  = (\prod{X})^{\frac{1}{n}} \rightarrow 10^{\frac{\sum{lgX}}{n}}\)</span></li>
</ol>
<ul>
<li>任意其它分布选用中位数，全距/四分位数</li>
</ul>
<ol type="1">
<li><span class="math inline">\(M = L + \frac{i}{f_X}(n \cdot X\% - \sum{f_L})\)</span></li>
</ol>
</section>
<section id="分类变量" class="level2">
<h2 class="anchored" data-anchor-id="分类变量">分类变量</h2>
<p>分类变量数据主要依赖于各种相对数描述，包括比例（proportion），速率（rate）， 相对比（ratio）. 其中rate主要涉及到时间的概念，需要注意孕妇死亡率等是相对比指标。</p>
<p>数据的标准化法：</p>
<ol type="1">
<li>直接化法，按总人口统一人口数，等价于对每组分层数据的率求均值-即每组中每个分层的权重都一致。</li>
<li>间接法， 依据标准化率计算不同组的理论值，实际值与理论值之比即得到标准化死亡比（standard mortality ration, SMR）, 进而求得当地的标准化死亡率 <span class="math inline">\(p' = p \cdot SMR\)</span>.</li>
</ol>
<p>动态数列：定基/环比，变化/增长（-1），平均发展速度/平均变化速度(-1)。</p>
</section>
</section>
<section id="实验设计与调查研究" class="level1">
<h1>实验设计与调查研究</h1>
<section id="实验设计" class="level2">
<h2 class="anchored" data-anchor-id="实验设计">实验设计</h2>
<p>医学实验的特点：最终对象是人</p>
<ol type="1">
<li>人具有生物学和社会学属性。</li>
<li>人的个体变异性较大，实验单位的一致性较差，观察结果的离散程度较大。</li>
<li>一般不允许在人体上直接实验，需先进行动物实验。</li>
</ol>
<p>医学实验设计要素：</p>
<ol type="1">
<li>处理因素。</li>
<li>受试对象。受试对象要求对处理因素敏感，以及反应稳定。</li>
<li>实验效应。</li>
</ol>
<p>实验设计的基本原则：</p>
<ol type="1">
<li>对照。</li>
<li>随机化。包括抽取随机，分配随机，相同机会接受不同的实验顺序三层含义。</li>
<li>重复。</li>
<li>知情同意。</li>
</ol>
<p>常用的设计方案包括完全随机化，区组化设计，析因设计以及被试内设计。被试内设计通过将个体的差异转化为重复测量的差异，而减少了误差。</p>
</section>
<section id="调查研究" class="level2">
<h2 class="anchored" data-anchor-id="调查研究">调查研究</h2>
<p>调查研究最大特点在于其只能被动观察，以及需要更大样本进而有更大的误差。</p>
<p>调查设计的原则需要完整，可行，经济，时效。</p>
<p>可行性分析可以通过逻辑分析，或者经验判断，或者试调查。</p>
<p>抽样的基本程序包括界定研究总体和调查总体，设计抽样方法，编制抽样框架，抽取样本，评估样本。</p>
<p>调查技术包括问卷，电话，访谈，观察法以及敏感问题调查技术-随机化应答技术。</p>
<p>非抽样误差包括抽样框误差，无回答误差，以及计量误差。</p>
<p>非抽样误差的估计有以下方法：</p>
<ol type="1">
<li>调查质量控制措施的完善程度和落实情况。</li>
<li>调查的应答率。</li>
<li>比较不同来源的资料。</li>
<li>进行抽样复查。</li>
</ol>
</section>
</section>
<section id="parametric-statistics" class="level1">
<h1>Parametric Statistics</h1>
<section id="sampling-distribution-for-chi2-f-t" class="level2">
<h2 class="anchored" data-anchor-id="sampling-distribution-for-chi2-f-t">Sampling Distribution for <span class="math inline">\(\chi^2, F, t\)</span></h2>
<p>首先给出各分布构造的定义：</p>
<ul>
<li>若 <span class="math inline">\(\left\{  X_i \right\}_{i=1}^n\)</span> 独立同分布于 <span class="math inline">\(N(0, 1)\)</span>， 那么 <span class="math inline">\(\sum{X_i^2} \sim \chi^2(n)\)</span>, 其 <span class="math inline">\(E(\chi^2) = n, Var(\chi^2) = 2n\)</span>.</li>
<li>若有 <span class="math inline">\(\chi^2_1(m)\)</span>, <span class="math inline">\(\chi^2_2(n)\)</span>, 那么 <span class="math inline">\(\frac{\frac{\chi_1^2}{m}}{\frac{\chi_2^2}{n}} \sim F(m - 1, n -1).\)</span></li>
<li>若有 <span class="math inline">\(X \sim \mathcal{N}(0, 1)\)</span>， 以及 <span class="math inline">\(\chi^2(n)\)</span>, 那么 <span class="math inline">\(\frac{X}{\sqrt{\frac{\chi^2(n)}{n}}} \sim t(n)\)</span></li>
</ul>
<div id="thm-th1" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1</strong></span> 设 <span class="math inline">\(\left\{ x_{i} \right\}_{i=1}^{n}\)</span> 是来自正态总体 <span class="math inline">\(\mathcal{N}(\mu, \sigma^2)\)</span> 的样本，其样本均值和方差分别为:</p>
<ol type="1">
<li><span class="math inline">\(\bar{x} = \frac{1}{n}\sum{x_i}\)</span></li>
<li><span class="math inline">\(s^2 = \frac{1}{n-1}\sum{(x - \bar{x})^2}\)</span></li>
</ol>
<p>则：</p>
<ol type="1">
<li><span class="math inline">\(\bar{x} \sim \mathcal{N}(\mu, \sigma^2/n)\)</span></li>
<li><span class="math inline">\(\frac{(n-1)s^2}{\sigma^2} \sim \chi^2_{(n-1)}\)</span></li>
<li><span class="math inline">\(\bar{x}, s^2\)</span> 相互独立</li>
</ol>
<blockquote class="blockquote">
<ol type="1">
<li>这里描述的是正态总体样本的均值服从于正态分布，而其样本的方差 <span class="math inline">\(s\)</span> 服从于卡方分布。</li>
<li>注意 <span class="math inline">\(s\)</span> 是样本的方差，而不是属于样本均值正态分布的方差，样本均值的正态分布的方差为 <span class="math inline">\(\frac{\sigma^2}{n}\)</span></li>
</ol>
</blockquote>
</div>
<div id="thm-th2" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2</strong></span> 设 <span class="math inline">\(\left\{ x_i \right\}_{i=1}^m\)</span> 是来自 <span class="math inline">\(\mathcal{N}(\mu_1, \sigma_1)\)</span> 的样本，<span class="math inline">\(\left\{ y_i \right\}_{i=1}^n\)</span> 是来自 <span class="math inline">\(\mathcal{N}(\mu_2, \sigma_2)\)</span> 的样本，那么：</p>
<ol type="1">
<li><span class="math inline">\(\bar{x} = \frac{1}{m}\sum{x}, \bar{y} = \frac{1}{n}\sum{y}\)</span></li>
<li><span class="math inline">\(s_x^2 = \frac{1}{m-1}\sum{(x - \bar{x})^2}, s_y^2 = \frac{1}{n -1}\sum{(y - \bar{y})^2}\)</span></li>
</ol>
<p>则：</p>
<ol type="1">
<li><span class="math inline">\(\frac{s_x^2/\sigma_1^2}{s_y^2/\sigma_2^2} \sim F(m - 1, n - 1)\)</span></li>
</ol>
<p>证明：</p>
<ol type="1">
<li><span class="math inline">\(\frac{(m - 1)s_x^2}{\sigma^1} \sim \chi^2(m - 1), \frac{(n - 1)s_y^2}{\sigma_2^2} \sim \chi^2(n-1)\)</span></li>
<li><span class="math inline">\(\frac{(1.1)/(m - 1)}{(1.2)/(n-1)} \sim F(m - 1, n - 1)\)</span></li>
</ol>
</div>
<div id="thm-th3" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3</strong></span> 设 <span class="math inline">\(\left\{ x_{i} \right\}_{i=1}^{n}\)</span> 是来自正态总体 <span class="math inline">\(\mathcal{N}(\mu, \sigma^2)\)</span> 的样本，其样本均值和方差分别为:</p>
<ol type="1">
<li><span class="math inline">\(\bar{x} = \frac{1}{n}\sum{x_i}\)</span></li>
<li><span class="math inline">\(s^2 = \frac{1}{n-1}\sum{(x - \bar{x})^2}\)</span></li>
</ol>
<p>则：</p>
<ol type="1">
<li><span class="math inline">\(\frac{\bar{x} - \mu}{\sigma \cdot \sqrt{\frac{1}{n}}} \sim t(n-1)\)</span></li>
</ol>
<p>证明：</p>
<ol type="1">
<li><span class="math inline">\(\frac{\bar{x} - \mu}{\sigma \cdot \sqrt{n}} \sim \mathcal{N}(0, 1)\)</span></li>
<li><span class="math inline">\(\frac{(n - 1)s^2}{\sigma^2} \sim \chi^2(n - 1)\)</span></li>
<li><span class="math inline">\(\frac{(1)}{\sqrt{(2)/(n - 1)}} \rightarrow  \frac{\bar{x} - \mu}{s\cdot \sqrt{\frac{1}{n}}} \sim t(n-1)\)</span></li>
</ol>
</div>
<div id="thm-th4" class="theorem">
<p><span class="theorem-title"><strong>Theorem 4</strong></span> 设 <span class="math inline">\(\left\{ x_i \right\}_{i=1}^m\)</span> 是来自 <span class="math inline">\(\mathcal{N}(\mu_1, \sigma_1^2)\)</span> 的样本，<span class="math inline">\(\left\{ y_i \right\}_{i=1}^n\)</span> 是来自 <span class="math inline">\(\mathcal{N}(\mu_2, \sigma_2^2)\)</span> 的样本，那么：</p>
<ol type="1">
<li><span class="math inline">\(\bar{x} = \frac{1}{m}\sum{x}, \bar{y} = \frac{1}{n}\sum{y}\)</span></li>
<li><span class="math inline">\(s_x^2 = \frac{1}{m-1}\sum{(x - \bar{x})^2}, s_y^2 = \frac{1}{n -1}\sum{(y - \bar{y})^2}\)</span></li>
</ol>
<p>设 <span class="math inline">\(\sigma_1^2 = \sigma_2^2 = \sigma^2\)</span>, 则：</p>
<ol type="1">
<li><span class="math inline">\(\frac{(\bar{x} - \bar{y}) - (\mu_1 - \mu_2)}{s_p \cdot \sqrt{\frac{1}{m} + \frac{1}{n}}} \sim t(m + n - 2), \text{Where } s_p^2 = \frac{(m - 1)s_x^2 + (n - 1)s_y^2}{m + n - 2}\)</span></li>
</ol>
<p>证明：</p>
<p>由两样本独立且正态分布：</p>
<ol type="1">
<li><span class="math inline">\((\bar{x} - \bar{y}) - (\mu_1 - \mu_2) \sim \mathcal{N}(\mu_1 - \mu_1, (\frac{1}{m} + \frac{1}{n})\sigma^2)\)</span></li>
<li><span class="math inline">\(\frac{(\bar{x} - \bar{y}) - (\mu_1 - \mu_2)}{\sigma \cdot \sqrt{\frac{1}{m} + \frac{1}{n}}} \sim \mathcal{N}(0, 1)\)</span></li>
</ol>
</div>
<p>由卡方变量可加性：</p>
<ol type="1">
<li><span class="math inline">\(\frac{(m - 1)s_x^2}{\sigma_1^2} \sim \chi^2(m - 1), \frac{(n-1)s_y^2}{\sigma_2^2} \sim \chi^2(n-1)\)</span></li>
<li><span class="math inline">\(\frac{(m - 1)s_x^2}{\sigma^2} + \frac{(n-1)s_y^2}{\sigma^2} \sim \chi^2(m + n - 2）\rightarrow \frac{s_p^2 \cdot (m + n - 2)}{\sigma^2} \sim \chi^2(m + n - 2)\)</span></li>
</ol>
</section>
<section id="tz-text-test" class="level2">
<h2 class="anchored" data-anchor-id="tz-text-test"><span class="math inline">\(t/z \text{ Test }\)</span></h2>
<section id="assumptions-and-its-application-case" class="level3">
<h3 class="anchored" data-anchor-id="assumptions-and-its-application-case">Assumptions and Its Application Case</h3>
<p>From <a href="https://en.wikipedia.org/wiki/Student%27s_t-test#Assumptions">wikipedia</a>:</p>
<blockquote class="blockquote">
<p>For exactness, the t-test and Z-test require normality of the sample means, and the t-test additionally requires that the sample variance follows a scaled <span class="math inline">\(\chi^2\)</span> distribution, and that the sample mean and sample variance be statistically independent. Normality of the individual data values is not required if these conditions are met. By the central limit theorem, sample means of moderately large samples are often well-approximated by a normal distribution even if the data are not normally distributed. For non-normal data, the distribution of the sample variance may deviate substantially from a <span class="math inline">\(\chi^2\)</span> distribution.</p>
<p>However, if the sample size is large, Slutsky’s theorem implies that the distribution of the sample variance has little effect on the distribution of the test statistic. That is as sample size</p>
<ul>
<li><p><span class="math inline">\({\displaystyle {\sqrt {n}}({\bar {X}}-\mu )\xrightarrow {d} N\left(0,\sigma ^{2}\right)}\)</span> as per the Central limit theorem.</p></li>
<li><p><span class="math inline">\({\displaystyle s^{2}\xrightarrow {p} \sigma ^{2}}\)</span> as per the Law of large numbers.</p></li>
<li><p><span class="math inline">\({\displaystyle \therefore {\frac {{\sqrt {n}}({\bar {X}}-\mu )}{s}}\xrightarrow {d} N(0,1)}\)</span></p></li>
</ul>
</blockquote>
<p>我们知道 <span class="math inline">\(t\)</span> 分布的构造定义如下：</p>
<p><span class="math display">\[
\frac{X}{\sqrt{\chi_{(n - 1)}/{(n-1)}}}, \text{Where} X \sim \mathcal{N}(0, 1)
\]</span></p>
<p>从 <span class="math inline">\(t\)</span> 的构造中可知，我们需要一个 <span class="math inline">\(X \sim \mathcal{N}(0, 1)\)</span> 的正态变量；而在大样本情况下， 依据中心极限定理，样本均值总是符合正态分布。 进一步地，依据大数定理，<span class="math inline">\(s^2 \approx \sigma^2\)</span>， 所以直接用 <span class="math inline">\(s\)</span> 替代 <span class="math inline">\(\sigma\)</span> 可以进行 <span class="math inline">\(z\)</span> 检验。实际上，在大样本下如下公式总是成立的：</p>
<ol type="1">
<li><span class="math inline">\(\bar{x} \sim \mathcal{N}(\mu, \frac{1}{n}\sigma^2) \rightarrow \text{Central Limit Theory}\)</span></li>
</ol>
<blockquote class="blockquote">
<p>Specially, 设二项分布 <span class="math inline">\(X \sim B(n, p)\)</span>:</p>
<p>则：</p>
<ol type="1">
<li><p><span class="math inline">\(\bar{x} \sim \mathcal{N}(np, np(1-p)), \text{When} x \rightarrow \infty\)</span></p></li>
<li><p><span class="math inline">\(\hat{p} \sim \mathcal{N}(p, \frac{1}{n}p(1-p))\)</span> 对于二项分布而言，其总体的期望以及方差实际上描述的就是多次独立的伯努利实验的期望与方差。</p></li>
</ol>
</blockquote>
<p>而大样本下 <span class="math inline">\(t\)</span> 分布近似于 <span class="math inline">\(z\)</span> 分布。所以 <span class="math inline">\(t\)</span> 分布可以应用于小样本下的正态总体，以及大样本下的任意总体的均值的检验。</p>
</section>
<section id="one-smple-t-test" class="level3">
<h3 class="anchored" data-anchor-id="one-smple-t-test">One Smple <span class="math inline">\(t\)</span>-Test</h3>
<ol type="1">
<li><span class="math inline">\(\bar{x} \sim \mathcal{N}(\mu, \frac{1}{n}\sigma^2)  \rightarrow \frac{\bar{x} - \mu}{\sigma \cdot \sqrt{\frac{1}{n}}} \sim \mathcal{N}(0, 1)\)</span></li>
<li><span class="math inline">\(\frac{\bar{x} - \mu}{s \cdot \sqrt{\frac{1}{n}}} \sim t(n-1)\)</span></li>
</ol>
<p>应用条件：</p>
<ol type="1">
<li>小样本正态分布，大样本。</li>
</ol>
</section>
<section id="paired-t-test" class="level3">
<h3 class="anchored" data-anchor-id="paired-t-test">Paired <span class="math inline">\(t\)</span>-Test</h3>
<p><span class="math inline">\(t(\upsilon) = \frac{\left|\bar{d} - 0\right|}{s_{\bar{d}}} = \frac{\bar{d}}{s_{\bar{d}}}, \text{ where } \upsilon = \text{对子数} - 1, s_{\bar{d}} = s_d \cdot \sqrt{\frac{1}{n}}\)</span></p>
<p>证明：</p>
<ol type="1">
<li><span class="math inline">\(\frac{\bar{d} - \mu_d}{\sigma_d \cdot \sqrt{\frac{1}{n}}} \sim \mathcal{N}(0, 1)\)</span></li>
</ol>
<p>应用条件：</p>
<ol type="1">
<li>小样本下， <span class="math inline">\(d\)</span> 服从于正态分布。</li>
<li>大样本。</li>
</ol>
</section>
<section id="independent-two-sample-t-test" class="level3">
<h3 class="anchored" data-anchor-id="independent-two-sample-t-test">Independent Two Sample <span class="math inline">\(t\)</span>-Test</h3>
<p>When <span class="math inline">\(\sigma_1 = \sigma_2 = \sigma\)</span>:</p>
<ol type="1">
<li><span class="math inline">\(\frac{(\bar{x} - \bar{y}) - (\mu_1 - \mu_2)}{s_p \cdot \sqrt{\frac{1}{m} + \frac{1}{n}}} \sim t(m + n - 2), \text{Where } s_p^2= \frac{(m-1)s_x^2 + (n - 1)s_y^2}{m + n - 2}\)</span></li>
</ol>
<p>When <span class="math inline">\(\sigma_1 \neq \sigma_2 \text{ or Unknown for it} \rightarrow \text{ Welch's t-Test}\)</span>:</p>
<ol type="1">
<li><span class="math inline">\(t^\prime(\upsilon) = \frac{\bar{x} - \bar{y}}{\sqrt{\frac{s_1^2}{m} + \frac{s_2^2}{n}}}\)</span></li>
</ol>
<p>通过 <span class="math inline">\(\text{Satterhwaite}\)</span> 法，对自由度进行校正</p>
<ol type="1">
<li><span class="math inline">\(\upsilon = \frac{(\frac{s_1^2}{m} + \frac{s_2^2}{n})^2}{\frac{s_1^4}{m^2} + \frac{s_2^4}{n^2}}\)</span></li>
</ol>
</section>
</section>
<section id="bn-ppolambda-text-test" class="level2">
<h2 class="anchored" data-anchor-id="bn-ppolambda-text-test"><span class="math inline">\(B(n, p)/Po(\lambda) \text{ Test}\)</span></h2>
<p>设事件 <span class="math inline">\(A\)</span> 发生的概率为 <span class="math inline">\(\pi\)</span>, 那么在 <span class="math inline">\(n\)</span> 次伯努利试验中，该事件发生次数 <span class="math inline">\(k\)</span>:</p>
<ol type="1">
<li><span class="math inline">\(P(k) = \binom{n}{k} \pi^k \cdot(1-\pi)^{n - k}, \text{Where } \binom{n}{k} = \frac{n!}{k!\cdot(n-k)!}\)</span></li>
</ol>
<p>其中 <span class="math inline">\(\binom{n}{k}\)</span> 正好是 牛顿二项展开式 <span class="math inline">\(\left[ (1 - \pi) + \pi \right]^n\)</span> 第 <span class="math inline">\(k + 1\)</span> 项。</p>
<p>设 <span class="math inline">\(X \sim B(n, \pi)\)</span>, 则：</p>
<ol type="1">
<li><span class="math inline">\(X \sim \mathcal{N}(n\pi, n\pi(1 - \pi), \text{When } n\pi &gt; 5 \text{ and } n(1 - \pi) &gt; 5\)</span></li>
<li><span class="math inline">\(Z = \frac{X - n\pi}{\sqrt{n\pi{(1 - \pi)}}} = \frac{p - \pi}{\sqrt{\pi(1 - \pi)/n}} \sim \mathcal{N}(0, 1)\)</span></li>
<li><span class="math inline">\(p \sim \mathcal{N}(\pi, \frac{\pi(1-\pi)}{n})\)</span></li>
</ol>
<p>当 <span class="math inline">\(\pi\)</span> 特别小时，设 <span class="math inline">\(\lambda = n\pi\)</span>, 则当 <span class="math inline">\(n \rightarrow \infty\)</span> ：</p>
<ol type="1">
<li><span class="math inline">\(P(X) = \frac{e^{-\lambda}\lambda^X}{X!}\)</span></li>
</ol>
<blockquote class="blockquote">
<ol type="1">
<li><p><span class="math inline">\(n\)</span> 足够大，以至于每 <span class="math inline">\(\frac{1}{n}\)</span> 中只有发生与不发生两种情况。</p></li>
<li><p>每一份 <span class="math inline">\(\frac{1}{n}\)</span> 中其概率都为 <span class="math inline">\(\frac{\pi}{n}\)</span></p></li>
<li><p>每一份中之间是相互独立的。</p></li>
</ol>
</blockquote>
<p>则 <span class="math inline">\(X \sim Po(\lambda)\)</span></p>
<ol type="1">
<li><span class="math inline">\(X \sim \mathcal{N}(\lambda, \lambda) \rightarrow \frac{X - \lambda}{\sqrt{\lambda}} \sim \mathcal{N}(0, 1),\text{When } \lambda &gt; 20\)</span></li>
<li><span class="math inline">\(Z = \frac{X_1/n_1 - X_2/n_2}{\sqrt{X_1/n_1^2 + X_2/n_2^2}}\)</span></li>
</ol>
<p>泊松分布最大的特征就是其均值与方差都等于 <span class="math inline">\(\lambda\)</span>, 我们常用这一点来判断一个分布是否属于泊松分布。此外，泊松分布具有可加性 - 考虑 <span class="math inline">\(X_1 \sim Po(\lambda_1), X_2 \sim Po(\lambda_2)\)</span>, 且互相独立：</p>
<ol type="1">
<li><span class="math inline">\(X_1 + X_2 \sim Po(\lambda_1 + \lambda_2)\)</span></li>
</ol>
</section>
<section id="aanlysis-of-variance" class="level2">
<h2 class="anchored" data-anchor-id="aanlysis-of-variance">Aanlysis of Variance</h2>
<section id="one-way-annova" class="level3">
<h3 class="anchored" data-anchor-id="one-way-annova">One Way ANNOVA</h3>
<p>该假设的原理如下：</p>
<blockquote class="blockquote">
<p>If the group means are drawn from populations with the same mean values, the variance between the group means should be lower than the variance of the samples, following the central limit theorem - <a href="https://en.wikipedia.org/wiki/One-way_analysis_of_variance">wikipedia</a></p>
</blockquote>
<p>其需要满足的假设如下：</p>
<ol type="1">
<li>正态总体</li>
<li>方差齐性</li>
<li>样本独立性</li>
</ol>
<blockquote class="blockquote">
<p>Tiku (1971) found that “the non-normal theory power of F is found to differ from the normal theory power by a correction term which decreases sharply with increasing sample size.” The problem of non-normality, especially in large samples, is far less serious than popular articles would suggest - <a href="https://en.wikipedia.org/wiki/One-way_analysis_of_variance">wikipedia</a></p>
</blockquote>
<ol type="1">
<li><span class="math inline">\(Y_{ij} - \bar{Y} = (Y_{ij} - Y_i) + (Y_i - \bar{Y})\)</span></li>
<li><span class="math inline">\(\sum_{i=1}^a\sum_{j=1}^{n_i} \left( Y_{ij} - \bar{Y} \right)^2 = \sum_{i=1}^a\sum_{j=1}^{n_i} \left(Y_{ij} - Y_i \right)^2- \sum_{i=1}^a n_i\left( {Y_i - \bar{Y}} \right)^2\)</span></li>
<li><span class="math inline">\(F = \frac{\sum_{i=1}^a n_i\left( {\bar{Y_i} - \bar{Y}} \right)^2 \bigg{/} (a - 1)}{\sum_{i=1}^a\sum_{j=1}^{n_i} \left(Y_{ij} - \bar{Y_i} \right)^2 \bigg{/} (N - a)} \sim F_{(a-1, N-a)}\)</span></li>
</ol>
<p>从公式的推导之中可以看到，其核心在于对变异(SS, sum of squares)的分解 <span class="math inline">\(SS_{\text{total}} = SS_{\text{within group}} + SS_{\text{between group}}\)</span>。方差分析需要进行Levene’s方差齐性检验，该检验实际上是对每个值减去该组均值的差异做单因素方差分析：</p>
<ol type="1">
<li><span class="math inline">\(Z_{ij} = |Y_{ij} - \bar{Y_i}|\)</span></li>
<li><span class="math inline">\(L = \frac{\sum_{i=1}^a n_i\left( {\bar{Z_i}- \bar{Z}} \right)^2 \bigg{/} (a - 1)}{\sum_{i=1}^a\sum_{j=1}^{n_i} \left(Z_{ij} - \bar{Z_i} \right)^2 \bigg{/} (N - a)} \sim F_{(a-1, N-a)})\)</span></li>
</ol>
</section>
<section id="special-two-way-annova---random-block-design" class="level3">
<h3 class="anchored" data-anchor-id="special-two-way-annova---random-block-design">Special Two Way ANNOVA - Random Block Design</h3>
<p>当观测变量有多个时，进行方差分析，不仅要考虑每个变量的观测值的影响，还需要考虑变量之间的交互作用对观测值的影响。而随机区块设计通过分组以后再进行随机化，使得我们可以不考虑两者的交互作用，只考虑两个变量分别对结果的影响；</p>
<ol type="1">
<li><span class="math inline">\(Y_{ij} - \bar{Y} = (\bar{Y_i} - \bar{Y}) + (\bar{Y_j} - \bar{Y}) + (Y_{ij} - \bar{Y_i} - \bar{Y_j} + \bar{Y})\)</span></li>
</ol>
<p>从上面的公式可以看出，随机区组设计将变异分为两个变量来源（区组，实验因素），以及个体本身的误差，其中误差项的自由度为 <span class="math inline">\((n-1)(\upsilon - 1).\)</span></p>
</section>
</section>
<section id="mutiple-hypothesis-test" class="level2">
<h2 class="anchored" data-anchor-id="mutiple-hypothesis-test">Mutiple Hypothesis Test</h2>
<p>方差分析对各处理组均数是否相等总的检验，在<span class="math inline">\(H_0\)</span>被拒绝以后，需要确定究竟是哪些处理组之间存在差异，此时需要进行均数之间的多重比较，这就涉及到累计 Ⅰ率。</p>
<p>当 <span class="math inline">\(a\)</span> 个处理组均数需要两两比较时候，共需要比较 <span class="math inline">\(c = a![2!(a-1)!].\)</span> 设每次检验的检验的检验水准为 <span class="math inline">\(\alpha\)</span> ,累积Ⅰ型错误概率为 <span class="math inline">\('\alpha\)</span>, 则</p>
<ol type="1">
<li><span class="math inline">\('\alpha = 1 - (1 - \alpha)^c\)</span></li>
</ol>
<section id="q--teststudent-newman-keuls" class="level3">
<h3 class="anchored" data-anchor-id="q--teststudent-newman-keuls"><span class="math inline">\(q\)</span> -Test/student Newman-Keuls</h3>
<p><span class="math inline">\(q \text{Test}\)</span> 用于任意两组之间的相互比较，SNK法的检验效能介于Bonferroni和Tukey法之间的；当比较均值的组数较多时，Tukey法更有效，组数较少时，ferroni法更有效。</p>
<p>其计算过程如下：</p>
<ol type="1">
<li>将各组的平均值按由小到大的顺序排列。</li>
<li>计算过两个平均之间的差值以及组间跨度 <span class="math inline">\(r\)</span></li>
<li>按下列公式计算统计量<span class="math inline">\(q\)</span>.</li>
</ol>
<p>则 <span class="math inline">\(q\)</span> 统计量：</p>
<ol type="1">
<li><span class="math inline">\(q = \frac{{\bar{Y_i} - \bar{Y_h}}}{\sqrt{\frac{MS_{within \: group}}{2}(\frac{1}{n_i} + \frac{1}{n_h})}}\)</span></li>
</ol>
<p>其中 <span class="math inline">\(\bar{Y_i}, \bar{Y_h}\)</span> 及 <span class="math inline">\(n_i, n_h\)</span> 分别是两个比较组的均数以及样本例数， <span class="math inline">\(MS_{\text{within group}}\)</span> 为进行方差分析得到的组内均方。</p>
</section>
<section id="dunnett-t-test" class="level3">
<h3 class="anchored" data-anchor-id="dunnett-t-test"><span class="math inline">\(Dunnett-t\)</span> Test</h3>
<p><span class="math inline">\(t_D\)</span> 统计量处理组与对照组的比较，该统计量的计算如下：</p>
<ol type="1">
<li><span class="math inline">\(t_D = \frac{\bar{Y_i} - \bar{Y_c}}{\sqrt{MS_{within \: group} \times (\frac{1}{n}_i + \frac{1}{n_c})}}\)</span></li>
</ol>
<p>其中 <span class="math inline">\(\bar{Y_i}, \bar{Y_c}\)</span> 及 <span class="math inline">\(n_i, n_c\)</span> 分别是实验组与对照组的均数以及样本例数， <span class="math inline">\(MS_\text{within group}\)</span> 为进行方差分析得到的组内均方。</p>
</section>
</section>
</section>
<section id="non-parametric-statistics" class="level1">
<h1>Non-parametric Statistics</h1>
<section id="chi2-text-test" class="level2">
<h2 class="anchored" data-anchor-id="chi2-text-test"><span class="math inline">\(\chi^2 \text{ Test}\)</span></h2>
<p>卡方检验用于观测变量为无序分类变量时， 用于检验零假设下观测频数与理论频数(将所有组合并为一个组计算出的每个结局的频率分布，然后乘以原组的频数)之间偏离如此大范围的概率（如果观测变量为有序的分类变量，则该使用秩相关的检验）。该方法应用的条件如下：</p>
<blockquote class="blockquote">
<ol type="1">
<li><p>不宜有 <span class="math inline">\(\frac{1}{5}\)</span> 的格子数的理论频数小于 <span class="math inline">\(5\)</span>, 或有一个格子的理论频数小于1，否则将导致分析的偏性。可采取扩大样本含量，或者合并或者删除不符合条件的数据。后两者会损失信息，样本随机性，可能会影响推断结论。</p></li>
<li><p>多个样本率（即多分组，观测变量为无序的二分类变量）的比较，显著的差异只能推断出这几组之间有总体的差异，但是不能推出其中两者之间是否存在差异。此时可将不同组的数据两两组合重新进行卡方检验进行推断，此时的检验水准的计算公式为 <span class="math inline">\(\frac{\alpha}{k(k-1)/2 + 1}\)</span></p></li>
</ol>
</blockquote>
<p>考虑一个 <span class="math inline">\(R \cdot  C\)</span> 的列联表</p>
<ol type="1">
<li><span class="math inline">\(\chi^2 = \sum\frac{(O - E)^2}{E}, \text{Where} E_{rc}= \frac{n_{r}n_{c}}{n} \rightarrow \chi^2 = n(\sum\frac{O^2}{n_{r}n_{c}} - 1)\)</span></li>
</ol>
<blockquote class="blockquote">
<ol type="1">
<li>如果为单变量，按样本分组；如果观测变量是无序二分类的，则是率的比较；如果观测变量为无序多分类，则为频数分布的比较。</li>
<li>如果为两个无序的观测变量，则为两个观测变量关联性检验，此时还需要进一步计算关联系数 <span class="math inline">\(C \text{ (contigency coefficient)} = \sqrt{\frac{\chi^2}{n + \chi^2}}\)</span></li>
</ol>
</blockquote>
<p>对于称为四格表的资料,即 <span class="math inline">\(2*2\)</span> 的列联表，其计算的简化形式为：</p>
<ol type="1">
<li><span class="math inline">\(\chi^2 = \frac{(ad - bc)^2n}{(a+b)(c+d)(a+c)(b+d)}\)</span></li>
</ol>
<p>特别地， 当理论频数存在 <span class="math inline">\(1 &lt; E &lt; 5\)</span> 时有如下的 Yate correction for continuity：</p>
<ol type="1">
<li><span class="math inline">\(\chi^2 = \sum\frac{(\mid O - E \mid - 0.5)^2}{E} = \frac{(|ad - bc| - \frac{n}{2})^2n}{(a+b)(c+d)(a+c)(b+d)}\)</span></li>
</ol>
<blockquote class="blockquote">
<p>实际上Pearson卡方值是正态总体中一种连续性的变量，四格表资料的卡方值为不连续的值，卡方分布仅仅是对表格资料的统计量分布的近似分布。 当四格表中有小于5的期望值时，其卡方值偏大，减去 <span class="math inline">\(0.5\)</span> 进行Yate 的连续性校正。</p>
</blockquote>
<p>若 <span class="math inline">\(n \le 40 \text{ or } E \le 1\)</span> 则采用Fisher确切概率法。</p>
<ol type="1">
<li><span class="math inline">\(P = \frac{\binom{a + c}{a}\binom{b + d}{b}}{\binom{n}{a + b}} = \frac{(a+b)!(a+c)!(b+c)!(b+d)!}{a!b!c!d!n!}\)</span></li>
</ol>
<blockquote class="blockquote">
<p>实际上fisher确切概率法给出了 <span class="math inline">\(R * C\)</span> 列联表的确切概率，可以用于任意情况的检验；但是这里给出的是某一种情况的概率，为了求得比当前情况都更为极端的差值，在四格表资料中我们比较的两个样本率的比较，因此对于所有率的差值大于原假设的极端情况，我们需要计算所有的概率累加，得到发生如此极端值的概率。</p>
</blockquote>
<p>当四格表资料为配对设计时，该检验称为 Mc-Nemar Test, 检验两者阳性率是否一致，该值完全由两组中阳性的频数决定，则：</p>
<ol type="1">
<li><span class="math inline">\(\chi^2 = \frac{(b - c)^2}{b + c}, \upsilon = 1\)</span></li>
</ol>
<p>若 <span class="math inline">\(b + c \le 40\)</span>, 则：</p>
<ol type="1">
<li><span class="math inline">\(\chi^2 = \frac{(|b-c|-1)^2}{b+c}, \upsilon = 1\)</span></li>
</ol>
<p>因为 Pearson <span class="math inline">\(\chi^2\)</span> 能反映实际频数和理论频数的的吻合程度，所以 <span class="math inline">\(\chi^2\)</span> 检验可以用作频数分布的拟合优度检验（goodness of fit test)，用于判断样本是否符合正态分布，二项分布，Possion分布等。</p>
</section>
<section id="rank-based-test" class="level2">
<h2 class="anchored" data-anchor-id="rank-based-test">Rank Based Test</h2>
<p>用于总体分布未知，且观测变量为数值变量或者有序分类变量情况，需要关注的是不同的秩和检验的秩和 <span class="math inline">\(T\)</span> 是如何计算的。</p>
<section id="wilcoxon-signed-rank-test-for-paired-sample" class="level3">
<h3 class="anchored" data-anchor-id="wilcoxon-signed-rank-test-for-paired-sample">Wilcoxon Signed Rank Test for Paired Sample</h3>
<p>依差值的绝对值从小到大编秩。编秩时遇到差值为 <span class="math inline">\(0\)</span> 的舍去不计，同时样本例数 <span class="math inline">\(n - 1\)</span> ; 遇到绝对值差值相等差数，符号相同则顺次编秩，符号相反则取平均秩次，再给秩次冠以原差值的正负号。分别计算出正负秩次 <span class="math inline">\(T_+, T_-,\)</span>任取其中一个作为统计量秩和 <span class="math inline">\(T\)</span></p>
<ol type="1">
<li><span class="math inline">\(T \sim \mathcal{N}(\frac{n(n+1)}{4}, \frac{n(n+1)(2n+1)}{24}), \text{When } n &gt; 25\)</span></li>
<li><span class="math inline">\(Z = \frac{\mid T - n(n + 1)/4  \mid - 0.5}{\sqrt{n(n+1)(2n+1)/24}} \text{ 其中 0.5 为连续性校正常数。}\)</span></li>
</ol>
<p>当相同差值数较多时（不包括差值为0的值)，校正式</p>
<ol type="1">
<li><span class="math inline">\(Z = \frac{\mid T - n(n + 1)/4  \mid - 0.5}{\sqrt{n(n+1)(2n+1)/24 - \frac{\sum(t_j^3 - t_j)}{48}}} \text{ 其中 $t_j$ 是第 $j$ 个相同差值的个数。}\)</span></li>
</ol>
</section>
<section id="wilcoxon-rank-sum-testmann-whitney-test-for-independent-two-samples" class="level3">
<h3 class="anchored" data-anchor-id="wilcoxon-rank-sum-testmann-whitney-test-for-independent-two-samples">Wilcoxon Rank Sum Test/Mann Whitney Test for Independent Two Samples</h3>
<ol type="1">
<li>若观测变量为数值变量：将两组原始数据分别从小到大排队，再将两组数据由小到大统一编秩，若有同组相同数据则顺序编秩，若有不同组别相同数据则取平均秩次。记两组中样本例数较小的为 <span class="math inline">\(n_1,\)</span> 其秩和为统计量<span class="math inline">\(T\)</span>.</li>
<li>若观测变量为有序的多分类变量：将每个观测单位按观测变量等级排序，则观测变量各个等级的平均秩次为该组观测单位秩次和的均值，则可求得每个分组的秩和，取观测单位数较小的组的秩和作为统计量 <span class="math inline">\(T\)</span>.</li>
</ol>
<p>则统计量 <span class="math inline">\(T\)</span>:</p>
<ol type="1">
<li><span class="math inline">\(T \sim \mathcal{N}(\frac{n_1(N+1)}{2}, \frac{n_1n_2(N+1)}{24}), \text{Where} N = n_1 + n_2\)</span></li>
<li><span class="math inline">\(Z = \frac{|T - \frac{n_1(N+1)}{2}| - 0.5}{\sqrt{\frac{n_1n_2(N+1)}{12}}}\)</span></li>
</ol>
<p>当相同秩较多时，有如下校正：</p>
<ol type="1">
<li><span class="math inline">\(Z_c = Z\sqrt{C}, \text{Where } C = 1 - \sum{(t_j^3 - t_j)}/(N^3 - N)\)</span></li>
</ol>
</section>
<section id="annova-for-rank" class="level3">
<h3 class="anchored" data-anchor-id="annova-for-rank">ANNOVA for Rank</h3>
<p>单因素的方差分析对应Kruskal-Wallis Test, 随机区组设计的方差分析对应Freidman Test.</p>
<section id="kruskal-wallis-test" class="level4">
<h4 class="anchored" data-anchor-id="kruskal-wallis-test">Kruskal-Wallis Test</h4>
<p>构造<span class="math inline">\(H\)</span>统计量：假设有 <span class="math inline">\(a\)</span> 个组，第 <span class="math inline">\(i\)</span> 组的样本量 <span class="math inline">\(n_i\)</span>, <span class="math inline">\(N\)</span> 为各组样本量之和，将各组数据合并，编秩次，秩次相同的取平均值。<span class="math inline">\(R_{ij}\)</span> 为第 <span class="math inline">\(i\)</span> 个组的第 <span class="math inline">\(j\)</span> 个个体的秩次，<span class="math inline">\(\bar{R_i}\)</span>为第 <span class="math inline">\(i\)</span> 个组的平均秩次，<span class="math inline">\(\bar{R}\)</span> 为总平均秩次。</p>
<p>没有相同秩次时，秩次服从均匀分布：</p>
<ol type="1">
<li><span class="math inline">\(H =\frac{12}{N(N + 1)}(\sum\frac{R_i^2}{n_i}) - 3(N+1).\)</span></li>
</ol>
<p>相同秩次过多时，上诉以均匀分布为基础推导的公式需要进行校正：</p>
<ol type="1">
<li><span class="math inline">\(H_c = H/C\)</span></li>
</ol>
<p>其中 <span class="math inline">\(C = 1 - \sum(t_j^3 - t_j) / (N^3 - N) .\)</span></p>
<p><span class="math inline">\(n_i\)</span> 与 <span class="math inline">\(a\)</span> 较小时 直接计算或者查表。</p>
<p><span class="math inline">\(n\)</span> 较大时, <span class="math inline">\(H\)</span> 近似服从于 <span class="math inline">\(\chi^2_{a-1}.\)</span></p>
</section>
<section id="friedman-test" class="level4">
<h4 class="anchored" data-anchor-id="friedman-test">Friedman Test</h4>
<p>在区组(行）内进行编秩，有相同的则取平均秩次。<span class="math inline">\(i\)</span> 代表不同的区组，<span class="math inline">\(j\)</span> 代表不同地处理水平。</p>
<p><span class="math display">\[
M = \frac{\sum_{j=1}^{a}n(\bar{R}_j - \bar{R})^2}{\sum_{j=1}^{a}\sum_{i=1}^{n}(R_{ij} - \bar{R})^2 / n(a-1)}
\]</span></p>
<p>当相同秩过多时可以进行校正，校正系数为</p>
<p><span class="math display">\[
C = 1 - \sum_{j=1}^{a}\sum_{p=1}^{l_i}(t_{jp}^3 - t_{jp})/[na(a^2 -1 )]
\]</span></p>
<p><span class="math display">\[
M_c = M/C
\]</span></p>
<p>当 <span class="math inline">\(n\)</span> 以及 <span class="math inline">\(a\)</span> 较小时直接查表或精确计算。<span class="math inline">\(n\)</span> 较大时 <span class="math inline">\(M\)</span> 近似服从于 <span class="math inline">\(\chi^2_{a-1}.\)</span></p>
</section>
</section>
</section>
</section>
<section id="correlation-ann-linear-regression" class="level1">
<h1>Correlation ann Linear Regression</h1>
<section id="pearsonspearman-correlation" class="level2">
<h2 class="anchored" data-anchor-id="pearsonspearman-correlation">Pearson/Spearman Correlation</h2>
<p>考虑两个连续的正态分布变量 <span class="math inline">\(X, Y\)</span>, 那么其样本的 Pearson 积差相关系数(product-moment correlation coefficient):</p>
<ol type="1">
<li><span class="math inline">\(r_p = \frac{\sum(X - \bar{X})(Y - \bar{Y})}{\sqrt{\sum{(X - \bar{X})^2} \sum{(Y - \bar{Y})^2}}}\)</span></li>
<li><span class="math inline">\(t_r = \frac{r - 0}{S_r},  \upsilon = n -2 \text{ Where } S_r = \sqrt{\frac{1-r^2}{n-2}}\)</span></li>
</ol>
<p>对于相关有如下注意的问题：</p>
<ol type="1">
<li>分层数据合并假象，合并分层不改变其相关性时，才可以合并。</li>
<li>两个变量应该都是随机的，而不是控制一个变量，观察另一个变量的结果。</li>
</ol>
<p>对于非正态分布变量或者总体分布未知变量考虑使用 Spearman 等级相关(rank correlation)。将 <span class="math inline">\(n\)</span> 对观察值 <span class="math inline">\(X_i, Y_i\)</span> 由小到大编秩，则有：</p>
<ol type="1">
<li><span class="math inline">\(r_s = 1 - \frac{6\sum_{i=1}^{n}d_{i}^2}{n(n^2-1)}\)</span></li>
<li><span class="math inline">\(t_r = \frac{r - 0}{S_r},  \upsilon = n -2 \text{ Where } S_r = \sqrt{\frac{1-r^2}{n-2}} \text{ When } n \ge 20\)</span></li>
</ol>
</section>
<section id="simple-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="simple-linear-regression">Simple Linear Regression</h2>
<p>简单线性回归，即只有一个自变量的线性回归，其回归方程形式如下：</p>
<ol type="1">
<li><span class="math inline">\(\hat{Y} = a + bX\)</span></li>
<li><span class="math inline">\(b  = \frac{\sum{(X - \bar{X})(Y - \bar{Y})}}{\sum{(X - \bar{X})^2}}\)</span>, <span class="math inline">\(a = \bar{Y} - b\bar{X}\)</span></li>
</ol>
<p>对参数 <span class="math inline">\(b\)</span> 有如下 <span class="math inline">\(F\)</span> 检验：</p>
<ol type="1">
<li><span class="math inline">\(F = \frac{MS_{\text{regression}}}{MS_{\text{residuals}}}, \upsilon_{\text{regression}} = 1, \upsilon_{\text{residuls}} = n - 2\)</span></li>
</ol>
<p>对参数 <span class="math inline">\(b\)</span> 同时有如下 <span class="math inline">\(t\)</span> 检验：</p>
<ol type="1">
<li><span class="math inline">\(t_b = \frac{b-0}{S_b}, \upsilon = n - 2 \text{ Where } S_b = \frac{\sqrt{\frac{SS_{\text{residules}}}{n - 2}}}{\sqrt{\sum{(X - \bar{X})^2}}}\)</span></li>
<li><span class="math inline">\(t_b \pm t_{\alpha, \upsilon}(S_b)\)</span></li>
</ol>
<p>对于拟合程度的判断可由决定系数确定：</p>
<ol type="1">
<li><span class="math inline">\(R^2 = \frac{SS_\text{regressiion}}{SS_{\text{total}}}\)</span></li>
</ol>
<p>对于拟合的回归方程，确定数值 <span class="math inline">\(X_0\)</span>, 那么有：</p>
<ol type="1">
<li><span class="math inline">\(\mu_{Y|X_0} = \hat{Y_0} \pm t_{\alpha, \upsilon} S\sqrt{\frac{1}{n} + \frac{(X - X_0)^2}{\sum{(X-\bar{X})^2}}}\)</span></li>
<li><span class="math inline">\(Y_0 = \hat{Y_0} \pm t_{\alpha, \upsilon}S\sqrt{1 + \frac{1}{n} + \frac{(X_0 - \bar{X})^2}{\sum{(X - \bar{X})^2}}}\)</span></li>
</ol>
<p>利用上面的第二个式子可以进行统计控制，即如果想要将 <span class="math inline">\(Y\)</span> 控制在一定范围，则可以通过控制<span class="math inline">\(X\)</span> 将个体预测值控制在一定范围之中。</p>
</section>
</section>
<section id="关于假设检验中若干问题" class="level1">
<h1>关于假设检验中若干问题</h1>
<section id="假设检验原理" class="level2">
<h2 class="anchored" data-anchor-id="假设检验原理">假设检验原理</h2>
<p>若在假设之下计算得到发生样本如此极端以及更极端情况的概率（<em>1.根据总体分布直接计算概率 2. 根据样本统计量的分布计算概率</em>）小于预先设定的阈值，那么我们则选择拒绝该假设或相反。现实的数据总是抽象变量 - 总体，概率的结果。从现实数据中收集得到的某一指标的一些数据-样本， 都是该抽象变量的一些随机数据-。一个显而易见的事实是：<em>样本统计量总是围绕总体参数的周围分布</em>。若在假设之下，求得样本统计量的分布，则可求得假设之下样本统计量向总体参数偏离如此大范围的机率，则依据小概率定律，选择拒绝或者接受原假设。</p>
</section>
<section id="假设检验与置信区间" class="level2">
<h2 class="anchored" data-anchor-id="假设检验与置信区间">假设检验与置信区间</h2>
</section>
<section id="检验功效" class="level2">
<h2 class="anchored" data-anchor-id="检验功效">检验功效</h2>
</section>
<section id="统计量计算的bootstrap以及置换检验" class="level2">
<h2 class="anchored" data-anchor-id="统计量计算的bootstrap以及置换检验">统计量计算的Bootstrap以及置换检验</h2>
<p>但是在实际的假设检验过程，倘若需要求得样本统计量的分布，往往需要知晓总体的概率分布。由此在假设检验过程之中，除了零假设以外，实际上在样本统计量的分布的计算之中，同时隐含了总体的分布以及方差齐性等假设，而这些假设也有对应的检验方法。因此，<em>假设检验真正的概率应该所有假设概率的乘积，而不仅仅是在零假设之下所计算出的概率</em>。以上所考虑的是一定要得到样本统计量的确切分布，进而得到精确的概率，例如正态总体假设下，方差齐性的t test, 但是很多情况下我们不必得到样本统计量的精确分布，得到一个大概估计即可，例如大样本下的正态检验，<span class="math inline">\(R\times C\)</span>列表值用卡方分布近似，非参数检验-秩检验等。在计算机时代，我们可以直接利用Bootstrp模拟得到假设之下样本统计量的分布。</p>
</section>
<section id="假设检验与线性回归参数检验的等效性" class="level2">
<h2 class="anchored" data-anchor-id="假设检验与线性回归参数检验的等效性">假设检验与线性回归参数检验的等效性</h2>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/person-c\.github\.io\/doc\.cying\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>